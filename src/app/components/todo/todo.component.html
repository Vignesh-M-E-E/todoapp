<div class="container">
  <div class="header-section">
    <h1>{{ isEditMode ? 'Edit Todo' : 'Create Todo' }}</h1>
    <button type="button" (click)="logout()" class="btn-logout">Logout</button>
  </div>

  <!-- ===== FORM SECTION ===== -->
  <div class="form-section">
    <form (ngSubmit)="isEditMode ? updateTodo() : createTodo()">
      <div class="form-group">
        <label>Title</label>
        <input type="text" [(ngModel)]="title" name="title" placeholder="Enter title" required />
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="description" name="description" placeholder="Enter description" required></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Status</label>
          <select [(ngModel)]="status" name="status" required>
            <option *ngFor="let option of statusOptions" [value]="option">{{ option }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Priority</label>
          <select [(ngModel)]="priority" name="priority" required>
            <option *ngFor="let option of priorityOptions" [value]="option">{{ option }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Date</label>
          <input type="date" [(ngModel)]="date" name="date" required />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit">{{ isEditMode ? 'Update' : 'Create' }}</button>
        <button *ngIf="isEditMode" type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>

    <!-- Messages -->
    <div *ngIf="!loading && errorMessage" class="error-message">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  </div>

  <!-- ===== TODOS SECTION ===== -->
  <div class="todos-section">
    <div class="section-header">
      <h2>{{ isFilterActive ? 'Filtered Todos' : 'All Todos' }}</h2>

      <div class="filter-section">
        <label>Month:</label>
        <select [(ngModel)]="filterMonth" (change)="filterTodosByMonth()">
          <option *ngFor="let m of monthOptions" [value]="m.value">{{ m.name }}</option>
        </select>

        <label>Year:</label>
        <input type="number" [(ngModel)]="filterYear" (change)="filterTodosByMonth()" min="2020" max="2100" style="width:80px" />

        <button type="button" class="btn-filter" (click)="filterTodosByMonth()">Filter</button>
        <button *ngIf="isFilterActive" type="button" class="btn-clear-filter" (click)="clearFilter()">Clear</button>
        <button type="button" class="btn-refresh" (click)="loadTodos()">Refresh</button>
      </div>
    </div>

    <div *ngIf="loading" class="loading">Loading todos...</div>

    <div *ngIf="!loading && todos.length === 0 && !errorMessage" class="empty-state">
      No todos found. Create one above!
    </div>

    <div *ngIf="!loading && todos.length > 0" class="table-container">
      <table class="todos-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Date</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let todo of todos">
            <td>{{ todo.title }}</td>
            <td class="description-cell">{{ todo.description }}</td>
            <td>{{ todo.date | date:'MMM dd, yyyy' }}</td>
            <td><span [ngClass]="getStatusClass(todo.status)" class="status-badge">{{ todo.status }}</span></td>
            <td><span [ngClass]="getPriorityClass(todo.priority)" class="priority-badge">{{ todo.priority }}</span></td>
            <td>
              <button class="btn-edit" (click)="editTodo(todo)">Edit</button>
              <button class="btn-delete" (click)="deleteTodo(todo.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
